services:
  # Service name - will be used as the container name
  {{CONTAINER_NAME}}:
    
    build: .
    container_name: "{{CONTAINER_NAME}}"
    
    hostname: "{{CONTAINER_NAME}}"
    
    working_dir: /data_private
    
    volumes:
      - "{{PRIVATE_VOLUME}}:/data_private"
      - shared_data:/data_shared
    
    restart: always

    environment:
      - CONTAINER_NAME={{CONTAINER_NAME}}
      - TAGS={{TAGS}}

    labels:
      - "user.name={{CONTAINER_NAME}}"
      - "user.tags={{TAGS}}"
      - "managed_by=spin_up_script"
    
    deploy:
      resources:
        limits:
          cpus: '1.0'      # Max 1 CPU core
          memory: 512M      # Max 512 MB RAM
        reservations:
          cpus: '0.25'     # Guaranteed 0.25 CPU
          memory: 128M      # Guaranteed 128 MB RAM
    
    networks:
      - user_network
    
    # Port mapping (if needed)
    # Format: host_port:container_port
    # Uncomment if your container needs to expose services:
    # ports:
    #   - "8080:8080"  # Web server
    #   - "5432:5432"  # Database
    
    # Command override (optional)
    # Default is 'sleep infinity' to keep container alive
    # Uncomment to run a different command:
    # command: ["python", "app.py"]
    
    # Health check (optional but recommended)
    # Why healthcheck? Docker can monitor if container is functioning
    healthcheck:
      test: ["CMD", "pgrep", "-f", "sleep infinity"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

################################################################################
# Networks
# Why custom network? Enables container-to-container communication by name
################################################################################
networks:
  user_network:
    # Create network if it doesn't exist, or use existing one
    # Why external: true? Network created by spin_up script, shared by all
    external: true
    name: user_shared_network

################################################################################
# Volumes
# Why declare volumes here? Makes them explicit and manageable
################################################################################
volumes:
  # Private volume - unique per container
  {{PRIVATE_VOLUME}}:
    # External means Docker won't try to create it
    # We create it in the spin_up script instead
    external: true
  
  # Shared volume - same across all containers
  shared_data:
    external: true

################################################################################
# Additional Configuration Examples
################################################################################

# Example: Container that needs internet access disabled
#   services:
#     isolated_container:
#       network_mode: none  # No network access at all

# Example: Container with custom DNS
#   services:
#     custom_dns_container:
#       dns:
#         - 8.8.8.8
#         - 1.1.1.1

# Example: Container with specific user
#   services:
#     specific_user_container:
#       user: "1000:1000"  # Run as UID 1000

# Example: Container with capabilities
#   services:
#     privileged_container:
#       cap_add:
#         - NET_ADMIN  # For network operations
#         - SYS_ADMIN  # For system operations